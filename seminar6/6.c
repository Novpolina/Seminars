#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>

int a = 0; // Глобальная переменная, которая будет изменяться потоками

// Функция, которая будет выполняться в новых потоках
void *mythread(void *dummy) {
    /*
     * Параметр void *dummy используется лишь для совместимости типов
     * и не будет использован в этой функции.
     * Возвращаемое значение имеет тип void *, но не будет использовано в этой программе.
     */

    pthread_t mythid; // Идентификатор создаваемого потока
    mythid = pthread_self(); // Получаем идентификатор текущего потока

    a = a + 1; // Увеличиваем глобальную переменную a
    // Выводим идентификатор потока и значение a
    printf("Thread %u, Calculation result = %d\n", (unsigned int)mythid, a);

    return NULL; // Возвращаем NULL, так как результат не важен
}

int main() {
    pthread_t thid1, thid2, thid3; // Идентификаторы потоков
    int result; // Переменная для хранения результата создания потока

    // Создаем первый поток, который выполнит функцию mythread
    result = pthread_create(&thid1, NULL, mythread, NULL);
    if (result != 0) {
        printf("Error on thread create 1, return value = %d\n", result);
        exit(-1); // Завершаем программу в случае ошибки
    }

    // Создаем второй поток
    result = pthread_create(&thid2, NULL, mythread, NULL);
    if (result != 0) {
        printf("Error on thread create 2, return value = %d\n", result);
        exit(-1);
    }

    // Создаем третий поток
    result = pthread_create(&thid3, NULL, mythread, NULL);
    if (result != 0) {
        printf("Error on thread create 3, return value = %d\n", result);
        exit(-1);
    }

    // Выводим идентификаторы созданных потоков
    printf("Threads created, thid1 = %u, thid2 = %u, thid3 = %u\n", 
           (unsigned int)thid1, (unsigned int)thid2, (unsigned int)thid3);

    pthread_t mythid; // Идентификатор основного потока
    mythid = pthread_self(); // Получаем идентификатор основного потока

    a = a + 1; // Увеличиваем глобальную переменную a в основном потоке
    // Выводим идентификатор основного потока и значение a
    printf("Main Thread %u, Calculation result = %d\n", (unsigned int)mythid, a);

    // Ожидаем завершения всех потоков перед завершением программы
    pthread_join(thid1, NULL); 
    pthread_join(thid2, NULL);
    pthread_join(thid3, NULL);

    return 0; // Завершение программы
}

 /*Пояснения к работе программы:

Глобальная переменная a: Эта переменная объявлена вне функций и будет изменяться как основным, 
так и созданными потоками, что делает её общей для них.

Функция mythread: Эта функция будет выполняться в каждом из трёх созданных потоков. Каждый поток увеличивает 
значение a на 1 и выводит идентификатор потока и изменённое значение a.

Создание потоков: В функции main создаются три новых потока с помощью pthread_create, 
каждый из которых выполняет функцию mythread. Если создание какого-либо потока не удалось, 
программа завершается с выводом сообщения об ошибке.

Вывод идентификаторов созданных потоков: После успешного создания потоков выводим их идентификаторы на экран.

Основной поток: Основная программа (основной поток) также увеличивает значение переменной a 
и выводит его на экран вместе с его идентификатором.

Синхронизация с помощью pthread_join: Основной поток ожидает завершения всех трёх созданных 
потоков перед тем, как завершить свою работу. Это предотвращает ситуацию, когда основной поток 
завершается до того, как остальные потоки завершили свои операции. */